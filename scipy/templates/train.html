<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Train Model</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Absensi Wajah Web</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="/">Live Absensi</a></li>
                    <li class="nav-item"><a class="nav-link" href="/register">Registrasi</a></li>
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="/train">Train Model</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h2>Training Classifier</h2>
        <p>Proses ini akan mengambil semua data wajah yang sudah terdaftar dan melatih sebuah model untuk mengenali mereka. Klik tombol di bawah untuk memulai.</p>
        
        <div class="d-grid gap-2">
            <button id="train-btn" class="btn btn-primary btn-lg" onclick="startTraining()">
                Mulai Training
            </button>
            <button id="reload-btn" class="btn btn-success btn-lg" onclick="reloadClassifier()" style="display: none;">
                Muat Ulang Classifier di Server
            </button>
        </div>

        <h4 class="mt-4">Log Proses Training:</h4>
        <pre id="log-area" class="p-3 bg-dark text-white rounded" style="height: 300px; overflow-y: scroll;"></pre>
    </div>

    <script>
        function startTraining() {
            const trainBtn = document.getElementById('train-btn');
            const reloadBtn = document.getElementById('reload-btn');
            const logArea = document.getElementById('log-area');
            
            trainBtn.disabled = true;
            trainBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> Sedang Training...';
            reloadBtn.style.display = 'none';
            logArea.textContent = 'Memulai proses...\n';

            fetch('/start_training', { method: 'POST' });

            const intervalId = setInterval(() => {
                fetch('/training_status')
                    .then(response => response.json())
                    .then(data => {
                        if (data.log) {
                            logArea.textContent += data.log;
                            logArea.scrollTop = logArea.scrollHeight;
                        }
                        if (data.status === 'finished') {
                            clearInterval(intervalId);
                            trainBtn.disabled = false;
                            trainBtn.textContent = 'Mulai Training Ulang';
                            reloadBtn.style.display = 'block'; // Tampilkan tombol reload
                        }
                    });
            }, 1500);
        }

        function reloadClassifier() {
            fetch('/reload_classifier', { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            });
        }
    </script>
</body>
</html>
